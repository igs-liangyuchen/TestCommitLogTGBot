- name: AI Summarize with Gemini
        id: gemini_ai
        env:
          GEMINI_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # 1. 取得提交訊息
          LOG_DATA=$(git log -1 --pretty=format:"%s")
          
          # 2. 呼叫 API (切換至 v1 版本並使用 gemini-1.5-flash-latest)
          curl -X POST "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=$GEMINI_KEY" \
            -H 'Content-Type: application/json' \
            -d "{\"contents\": [{\"parts\":[{\"text\": \"請用繁體中文總結這次的 Git Commit 內容，並簡單說明這項改動的意義：$LOG_DATA\"}]}]}" > response.json

          # 3. 使用獨立的 Python 腳本解析
          python3 - <<EOF > summary.txt
          import json
          try:
              with open('response.json', 'r') as f:
                  data = json.load(f)
              if 'candidates' in data and len(data['candidates']) > 0:
                  content = data['candidates'][0]['content']['parts'][0]['text']
                  print(content)
              else:
                  # 如果有報錯，把整個 JSON 印出來看
                  err_msg = data.get('error', {}).get('message', '未知錯誤')
                  print(f'AI 報錯: {err_msg}')
          except Exception as e:
              print(f'解析出錯: {str(e)}')
          EOF

          echo "AI_RESULT=$(cat summary.txt)" >> $GITHUB_ENV